steps:

# =====Build=====
- name: 'gcr.io/cloud-builders/docker'
  args: [
    'build', 
    '-t', 'asia-east1-docker.pkg.dev/mdp-net/sleepzone-todos-webapp/sleepzone-todos-webapp', 
    '-f', './SleepZone.Todos.WebApp/Dockerfile', 
    '.'
  ]
  dir: 'src'
    
# =====Push=====
- name: 'gcr.io/cloud-builders/docker'
  args: [
    'push', 'asia-east1-docker.pkg.dev/mdp-net/sleepzone-todos-webapp/sleepzone-todos-webapp'
  ]
    
# =====Deploy=====
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: [
    'run', 
    'deploy', 'sleepzone-todos-webapp', 
    '--image', 'asia-east1-docker.pkg.dev/mdp-net/sleepzone-todos-webapp/sleepzone-todos-webapp', 
    '--region', 'asia-east1'
  ]